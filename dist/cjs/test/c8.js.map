{"version":3,"sources":["c8.js"],"sourcesContent":["const path = require('path');\nconst rimraf = require('rimraf');\nconst Queue = require('queue-cb');\nconst { spawnParams } = require('ts-swc-loaders');\n\nconst link = require('../link');\nconst spawn = require('../lib/spawn');\n\nconst major = +process.versions.node.split('.')[0];\nconst type = major < 12 ? 'commonjs' : 'module';\n\nmodule.exports = function c8(_args, options, cb) {\n  const cwd = options.cwd || process.cwd();\n\n  link(_args, options, (err, restore) => {\n    if (err) return cb(err);\n\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      rimraf(path.resolve(process.cwd(), 'coverage'), () => {\n        cb();\n      });\n    });\n    queue.defer((cb) => {\n      const cmd = require.resolve('c8/bin/c8');\n      let args = ['--config', path.join(__dirname, '..', '..', '..', 'assets', 'c8rc.json'), 'mocha', '--watch-extensions', 'ts,tsx'];\n      args = args.concat(_args.length ? _args.slice(-1) : ['test/**/*.test.*']);\n      const params = spawnParams(type, { cwd });\n      if (params.options.NODE_OPTIONS || params.args[0] === '--require') {\n        spawn(cmd, params.args.concat(args), params.options, cb);\n      } else {\n        spawn('node', params.args.concat([cmd]).concat(args), params.options, cb);\n      }\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n};\n"],"names":["path","require","rimraf","Queue","spawnParams","link","spawn","major","process","versions","node","split","type","module","exports","c8","_args","options","cb","cwd","err","restore","queue","defer","resolve","cmd","args","join","__dirname","concat","length","slice","params","NODE_OPTIONS","await","err2"],"mappings":";AAAA,IAAMA,OAAOC,QAAQ;AACrB,IAAMC,SAASD,QAAQ;AACvB,IAAME,QAAQF,QAAQ;AACtB,IAAM,AAAEG,cAAgBH,QAAQ,kBAAxBG;AAER,IAAMC,OAAOJ,QAAQ;AACrB,IAAMK,QAAQL,QAAQ;AAEtB,IAAMM,QAAQ,CAACC,QAAQC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;AAClD,IAAMC,OAAOL,QAAQ,KAAK,aAAa;AAEvCM,OAAOC,OAAO,GAAG,SAASC,GAAGC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAC7C,IAAMC,MAAMF,QAAQE,GAAG,IAAIX,QAAQW,GAAG;IAEtCd,KAAKW,OAAOC,SAAS,SAACG,KAAKC;QACzB,IAAID,KAAK,OAAOF,GAAGE;QAEnB,IAAME,QAAQ,IAAInB,MAAM;QACxBmB,MAAMC,KAAK,CAAC,SAACL;YACXhB,OAAOF,KAAKwB,OAAO,CAAChB,QAAQW,GAAG,IAAI,aAAa;gBAC9CD;YACF;QACF;QACAI,MAAMC,KAAK,CAAC,SAACL;YACX,IAAMO,MAAMxB,QAAQuB,OAAO,CAAC;YAC5B,IAAIE,OAAO;gBAAC;gBAAY1B,KAAK2B,IAAI,CAACC,WAAW,MAAM,MAAM,MAAM,UAAU;gBAAc;gBAAS;gBAAsB;aAAS;YAC/HF,OAAOA,KAAKG,MAAM,CAACb,MAAMc,MAAM,GAAGd,MAAMe,KAAK,CAAC,CAAC,KAAK;gBAAC;aAAmB;YACxE,IAAMC,SAAS5B,YAAYQ,MAAM;gBAAEO,KAAAA;YAAI;YACvC,IAAIa,OAAOf,OAAO,CAACgB,YAAY,IAAID,OAAON,IAAI,CAAC,EAAE,KAAK,aAAa;gBACjEpB,MAAMmB,KAAKO,OAAON,IAAI,CAACG,MAAM,CAACH,OAAOM,OAAOf,OAAO,EAAEC;YACvD,OAAO;gBACLZ,MAAM,QAAQ0B,OAAON,IAAI,CAACG,MAAM,CAAC;oBAACJ;iBAAI,EAAEI,MAAM,CAACH,OAAOM,OAAOf,OAAO,EAAEC;YACxE;QACF;QACAI,MAAMY,KAAK,CAAC,SAACd;YACXC,QAAQ,SAACc;gBACPjB,GAAGE,OAAOe;YACZ;QACF;IACF;AACF"}