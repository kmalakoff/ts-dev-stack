{"version":3,"sources":["mocha.js"],"sourcesContent":["const Queue = require('queue-cb');\n\nconst { link, installPath, spawn, optionsToArgs } = require('tsds-lib');\n\nconst major = +process.versions.node.split('.')[0];\nconst mochaName = major < 12 ? 'mocha-compat' : 'mocha';\n\nlet binMocha = null;\nmodule.exports = function mocha(_args, options, cb) {\n  if (!binMocha) binMocha = require.resolve(`${mochaName}/bin/_${mochaName}`);\n  const cwd = options.cwd || process.cwd();\n\n  link(installPath(options), (_err, restore) => {\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      let args = [binMocha, '--watch-extensions', 'ts,tsx'];\n      args = args.concat(optionsToArgs(options));\n      args = args.concat(_args.length ? _args.slice(-1) : ['test/**/*.test.*']);\n      spawn('ts-swc', args, { cwd }, cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n};\n\nmodule.exports.options = { alias: { temp: 't' } };\n"],"names":["Queue","require","link","installPath","spawn","optionsToArgs","major","process","versions","node","split","mochaName","binMocha","module","exports","mocha","_args","options","cb","resolve","cwd","_err","restore","queue","defer","args","concat","length","slice","await","err","err2","alias","temp"],"mappings":"AAAA,MAAMA,QAAQC,QAAQ;AAEtB,MAAM,EAAEC,IAAI,EAAEC,WAAW,EAAEC,KAAK,EAAEC,aAAa,EAAE,GAAGJ,QAAQ;AAE5D,MAAMK,QAAQ,CAACC,QAAQC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;AAClD,MAAMC,YAAYL,QAAQ,KAAK,iBAAiB;AAEhD,IAAIM,WAAW;AACfC,OAAOC,OAAO,GAAG,SAASC,MAAMC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAChD,IAAI,CAACN,UAAUA,WAAWX,QAAQkB,OAAO,CAAC,GAAGR,UAAU,MAAM,EAAEA,WAAW;IAC1E,MAAMS,MAAMH,QAAQG,GAAG,IAAIb,QAAQa,GAAG;IAEtClB,KAAKC,YAAYc,UAAU,CAACI,MAAMC;QAChC,MAAMC,QAAQ,IAAIvB,MAAM;QACxBuB,MAAMC,KAAK,CAAC,CAACN;YACX,IAAIO,OAAO;gBAACb;gBAAU;gBAAsB;aAAS;YACrDa,OAAOA,KAAKC,MAAM,CAACrB,cAAcY;YACjCQ,OAAOA,KAAKC,MAAM,CAACV,MAAMW,MAAM,GAAGX,MAAMY,KAAK,CAAC,CAAC,KAAK;gBAAC;aAAmB;YACxExB,MAAM,UAAUqB,MAAM;gBAAEL;YAAI,GAAGF;QACjC;QACAK,MAAMM,KAAK,CAAC,CAACC;YACXR,QAAQ,CAACS;gBACPb,GAAGY,OAAOC;YACZ;QACF;IACF;AACF;AAEAlB,OAAOC,OAAO,CAACG,OAAO,GAAG;IAAEe,OAAO;QAAEC,MAAM;IAAI;AAAE"}