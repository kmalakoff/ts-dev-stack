{"version":3,"sources":["mocha.js"],"sourcesContent":["const Queue = require('queue-cb');\nconst { spawnParams } = require('ts-swc-loaders');\n\nconst link = require('../link');\nconst spawn = require('../lib/spawn');\n\nconst major = +process.versions.node.split('.')[0];\nconst type = major < 12 ? 'commonjs' : 'module';\n\nmodule.exports = function mocha(_args, options, cb) {\n  link(_args, options, (_err, restore) => {\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      const cwd = options.cwd || process.cwd();\n      const mocha = major < 12 ? 'mocha-compat' : 'mocha';\n      const cmd = require.resolve(`${mocha}/bin/_${mocha}`);\n      let args = ['--watch-extensions', 'ts,tsx'];\n      for (const key in options) {\n        if (key === '_') continue;\n        if (options[key] === true) args.push(`--${key}`);\n        else if (options[key] === false) args.push(`--no-${key}`);\n        else args = args.concat([`--${key}`, options[key]]);\n      }\n      args = args.concat(_args.length ? _args.slice(-1) : ['test/**/*.test.*']);\n      const params = spawnParams(type, { cwd });\n      if (params.options.NODE_OPTIONS || params.args[0] === '--require') {\n        spawn(cmd, params.args.concat(args), params.options, cb);\n      } else {\n        spawn('node', params.args.concat([cmd]).concat(args), params.options, cb);\n      }\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n};\n\nmodule.exports.options = { alias: { temp: 't' } };\n"],"names":["Queue","require","spawnParams","link","spawn","major","process","versions","node","split","type","module","exports","mocha","_args","options","cb","_err","restore","queue","defer","cwd","cmd","resolve","args","key","push","concat","length","slice","params","NODE_OPTIONS","await","err","err2","alias","temp"],"mappings":"AAAA,MAAMA,QAAQC,QAAQ;AACtB,MAAM,EAAEC,WAAW,EAAE,GAAGD,QAAQ;AAEhC,MAAME,OAAOF,QAAQ;AACrB,MAAMG,QAAQH,QAAQ;AAEtB,MAAMI,QAAQ,CAACC,QAAQC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;AAClD,MAAMC,OAAOL,QAAQ,KAAK,aAAa;AAEvCM,OAAOC,OAAO,GAAG,SAASC,MAAMC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAChDb,KAAKW,OAAOC,SAAS,CAACE,MAAMC;QAC1B,MAAMC,QAAQ,IAAInB,MAAM;QACxBmB,MAAMC,KAAK,CAAC,CAACJ;YACX,MAAMK,MAAMN,QAAQM,GAAG,IAAIf,QAAQe,GAAG;YACtC,MAAMR,QAAQR,QAAQ,KAAK,iBAAiB;YAC5C,MAAMiB,MAAMrB,QAAQsB,OAAO,CAAC,CAAC,EAAEV,MAAM,MAAM,EAAEA,MAAM,CAAC;YACpD,IAAIW,OAAO;gBAAC;gBAAsB;aAAS;YAC3C,IAAK,MAAMC,OAAOV,QAAS;gBACzB,IAAIU,QAAQ,KAAK;gBACjB,IAAIV,OAAO,CAACU,IAAI,KAAK,MAAMD,KAAKE,IAAI,CAAC,CAAC,EAAE,EAAED,IAAI,CAAC;qBAC1C,IAAIV,OAAO,CAACU,IAAI,KAAK,OAAOD,KAAKE,IAAI,CAAC,CAAC,KAAK,EAAED,IAAI,CAAC;qBACnDD,OAAOA,KAAKG,MAAM,CAAC;oBAAC,CAAC,EAAE,EAAEF,IAAI,CAAC;oBAAEV,OAAO,CAACU,IAAI;iBAAC;YACpD;YACAD,OAAOA,KAAKG,MAAM,CAACb,MAAMc,MAAM,GAAGd,MAAMe,KAAK,CAAC,CAAC,KAAK;gBAAC;aAAmB;YACxE,MAAMC,SAAS5B,YAAYQ,MAAM;gBAAEW;YAAI;YACvC,IAAIS,OAAOf,OAAO,CAACgB,YAAY,IAAID,OAAON,IAAI,CAAC,EAAE,KAAK,aAAa;gBACjEpB,MAAMkB,KAAKQ,OAAON,IAAI,CAACG,MAAM,CAACH,OAAOM,OAAOf,OAAO,EAAEC;YACvD,OAAO;gBACLZ,MAAM,QAAQ0B,OAAON,IAAI,CAACG,MAAM,CAAC;oBAACL;iBAAI,EAAEK,MAAM,CAACH,OAAOM,OAAOf,OAAO,EAAEC;YACxE;QACF;QACAG,MAAMa,KAAK,CAAC,CAACC;YACXf,QAAQ,CAACgB;gBACPlB,GAAGiB,OAAOC;YACZ;QACF;IACF;AACF;AAEAvB,OAAOC,OAAO,CAACG,OAAO,GAAG;IAAEoB,OAAO;QAAEC,MAAM;IAAI;AAAE"}