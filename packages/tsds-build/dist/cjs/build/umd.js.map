{"version":3,"sources":["umd.mjs"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport Queue from 'queue-cb';\n\nimport rimraf2 from 'rimraf2';\nimport { source, spawn } from 'tsds-lib';\n\nconst packageName = 'tsds-build';\nfunction root(dir) {\n  if (path.basename(dir) === packageName) return dir;\n  const nextDir = path.dirname(dir);\n  if (nextDir === dir) throw new Error(`${packageName} not found`);\n  return root(nextDir);\n}\nconst config = path.resolve(root(__dirname), 'dist', 'esm', 'rollup-swc', 'index.mjs');\n\nexport default function umd(_args, options, cb) {\n  const cwd = options.cwd || process.cwd();\n  const src = path.resolve(cwd, source(options));\n\n  options = { ...options };\n  options.type = 'umd';\n  options.sourceMaps = true;\n  options.dest = path.join(cwd, 'dist', 'umd');\n  rimraf2(options.dest, { disableGlob: true }, () => {\n    const queue = new Queue(1);\n    queue.defer(spawn.bind(null, 'rollup', ['--config', config, '--input', src], { cwd }));\n    queue.defer(fs.writeFile.bind(null, path.join(options.dest, 'package.json'), '{\"type\":\"commonjs\"}'));\n    queue.await(cb);\n  });\n}\n"],"names":["umd","packageName","root","dir","path","basename","nextDir","dirname","Error","config","resolve","__dirname","_args","options","cb","cwd","process","src","source","type","sourceMaps","dest","join","rimraf2","disableGlob","queue","Queue","defer","spawn","bind","fs","writeFile","await"],"mappings":";;;;+BAgBA;;;eAAwBA;;;yDAhBT;2DACE;8DACC;8DAEE;uBACU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE9B,IAAMC,cAAc;AACpB,SAASC,KAAKC,GAAG;IACf,IAAIC,aAAI,CAACC,QAAQ,CAACF,SAASF,aAAa,OAAOE;IAC/C,IAAMG,UAAUF,aAAI,CAACG,OAAO,CAACJ;IAC7B,IAAIG,YAAYH,KAAK,MAAM,IAAIK,MAAM,AAAC,GAAc,OAAZP,aAAY;IACpD,OAAOC,KAAKI;AACd;AACA,IAAMG,SAASL,aAAI,CAACM,OAAO,CAACR,KAAKS,YAAY,QAAQ,OAAO,cAAc;AAE3D,SAASX,IAAIY,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAC5C,IAAMC,MAAMF,QAAQE,GAAG,IAAIC,QAAQD,GAAG;IACtC,IAAME,MAAMb,aAAI,CAACM,OAAO,CAACK,KAAKG,IAAAA,eAAM,EAACL;IAErCA,UAAU,mBAAKA;IACfA,QAAQM,IAAI,GAAG;IACfN,QAAQO,UAAU,GAAG;IACrBP,QAAQQ,IAAI,GAAGjB,aAAI,CAACkB,IAAI,CAACP,KAAK,QAAQ;IACtCQ,IAAAA,gBAAO,EAACV,QAAQQ,IAAI,EAAE;QAAEG,aAAa;IAAK,GAAG;QAC3C,IAAMC,QAAQ,IAAIC,gBAAK,CAAC;QACxBD,MAAME,KAAK,CAACC,cAAK,CAACC,IAAI,CAAC,MAAM,UAAU;YAAC;YAAYpB;YAAQ;YAAWQ;SAAI,EAAE;YAAEF,KAAAA;QAAI;QACnFU,MAAME,KAAK,CAACG,WAAE,CAACC,SAAS,CAACF,IAAI,CAAC,MAAMzB,aAAI,CAACkB,IAAI,CAACT,QAAQQ,IAAI,EAAE,iBAAiB;QAC7EI,MAAMO,KAAK,CAAClB;IACd;AACF"}