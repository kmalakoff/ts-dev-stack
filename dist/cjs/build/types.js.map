{"version":3,"sources":["types.js"],"sourcesContent":["var path = require('path');\nvar rimraf = require('rimraf');\nvar Iterator = require('fs-iterator');\nvar getTS = require('get-tsconfig-compat');\nvar createMatcher = require('ts-swc-loaders/lib/createMatcher.js');\n\nvar spawn = require('../lib/spawn');\nvar source = require('../lib/source');\n\nmodule.exports = function types(_args, options, cb) {\n  var cwd = options.cwd || process.cwd();\n  var src = source(options);\n  var srcFolder = path.dirname(path.resolve(cwd, src));\n  var dest = path.join(cwd, 'dist', 'types');\n\n  var config = getTS.getTsconfig(path.resolve(cwd, 'tsconfig.json'));\n  var matcher = createMatcher(config);\n  var tsArgs = [];\n  for (var key in config.config.compilerOptions) {\n    var value = config.config.compilerOptions[key];\n    tsArgs.push('--' + key);\n    tsArgs.push(Array.isArray(value) ? value.join(',') : value);\n  }\n\n  rimraf(dest, function () {\n    var files = [];\n    var iterator = new Iterator(srcFolder);\n    iterator.forEach(\n      function (entry, callback) {\n        if (!entry.stats.isFile()) return callback();\n        if (!matcher(entry.fullPath)) return callback();\n        files.push(entry.fullPath);\n        callback();\n      },\n      { callbacks: true, concurrency: 1024 },\n      function (err) {\n        if (err) return cb(err);\n        var args = files.concat(['--declaration', '--emitDeclarationOnly', '--outDir', dest]).concat(tsArgs);\n        spawn('tsc', args, { cwd: cwd }, cb);\n      }\n    );\n  });\n};\n"],"names":["path","require","rimraf","Iterator","getTS","createMatcher","spawn","source","module","exports","types","_args","options","cb","cwd","process","src","srcFolder","dirname","resolve","dest","join","config","getTsconfig","matcher","tsArgs","key","compilerOptions","value","push","Array","isArray","files","iterator","forEach","entry","callback","stats","isFile","fullPath","callbacks","concurrency","err","args","concat"],"mappings":";AAAA,IAAIA,OAAOC,QAAQ;AACnB,IAAIC,SAASD,QAAQ;AACrB,IAAIE,WAAWF,QAAQ;AACvB,IAAIG,QAAQH,QAAQ;AACpB,IAAII,gBAAgBJ,QAAQ;AAE5B,IAAIK,QAAQL,QAAQ;AACpB,IAAIM,SAASN,QAAQ;AAErBO,OAAOC,OAAO,GAAG,SAASC,MAAMC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAChD,IAAIC,MAAMF,QAAQE,GAAG,IAAIC,QAAQD,GAAG;IACpC,IAAIE,MAAMT,OAAOK;IACjB,IAAIK,YAAYjB,KAAKkB,OAAO,CAAClB,KAAKmB,OAAO,CAACL,KAAKE;IAC/C,IAAII,OAAOpB,KAAKqB,IAAI,CAACP,KAAK,QAAQ;IAElC,IAAIQ,SAASlB,MAAMmB,WAAW,CAACvB,KAAKmB,OAAO,CAACL,KAAK;IACjD,IAAIU,UAAUnB,cAAciB;IAC5B,IAAIG,SAAS,EAAE;IACf,IAAK,IAAIC,OAAOJ,OAAOA,MAAM,CAACK,eAAe,CAAE;QAC7C,IAAIC,QAAQN,OAAOA,MAAM,CAACK,eAAe,CAACD,IAAI;QAC9CD,OAAOI,IAAI,CAAC,OAAOH;QACnBD,OAAOI,IAAI,CAACC,MAAMC,OAAO,CAACH,SAASA,MAAMP,IAAI,CAAC,OAAOO;IACvD;IAEA1B,OAAOkB,MAAM;QACX,IAAIY,QAAQ,EAAE;QACd,IAAIC,WAAW,IAAI9B,SAASc;QAC5BgB,SAASC,OAAO,CACd,SAAUC,KAAK,EAAEC,QAAQ;YACvB,IAAI,CAACD,MAAME,KAAK,CAACC,MAAM,IAAI,OAAOF;YAClC,IAAI,CAACZ,QAAQW,MAAMI,QAAQ,GAAG,OAAOH;YACrCJ,MAAMH,IAAI,CAACM,MAAMI,QAAQ;YACzBH;QACF,GACA;YAAEI,WAAW;YAAMC,aAAa;QAAK,GACrC,SAAUC,GAAG;YACX,IAAIA,KAAK,OAAO7B,GAAG6B;YACnB,IAAIC,OAAOX,MAAMY,MAAM,CAAC;gBAAC;gBAAiB;gBAAyB;gBAAYxB;aAAK,EAAEwB,MAAM,CAACnB;YAC7FnB,MAAM,OAAOqC,MAAM;gBAAE7B,KAAKA;YAAI,GAAGD;QACnC;IAEJ;AACF"}