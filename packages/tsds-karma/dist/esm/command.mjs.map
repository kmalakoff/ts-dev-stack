{"version":3,"sources":["command.mjs"],"sourcesContent":["import path from 'path';\nimport Queue from 'queue-cb';\nimport { installPath, link, spawn } from 'tsds-lib';\n\nfunction packageRoot(dir, packageName) {\n  if (path.basename(dir) === packageName) return dir;\n  const nextDir = path.dirname(dir);\n  if (nextDir === dir) throw new Error(''.concat(packageName, ' not found'));\n  return packageRoot(nextDir, packageName);\n}\nconst config = path.join(packageRoot(__dirname, 'tsds-karma'), 'assets', 'karma.conf.js');\n\nexport default function karma(args, options, cb) {\n  link(installPath(options), (_err, restore) => {\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      const tests = args.length ? args[0] : 'test/**/*.test.*';\n      spawn('karma', ['start', config, tests], {}, cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n}\n"],"names":["path","Queue","installPath","link","spawn","packageRoot","dir","packageName","basename","nextDir","dirname","Error","concat","config","join","__dirname","karma","args","options","cb","_err","restore","queue","defer","tests","length","await","err","err2"],"mappings":"AAAA,OAAOA,UAAU,OAAO;AACxB,OAAOC,WAAW,WAAW;AAC7B,SAASC,WAAW,EAAEC,IAAI,EAAEC,KAAK,QAAQ,WAAW;AAEpD,SAASC,YAAYC,GAAG,EAAEC,WAAW;IACnC,IAAIP,KAAKQ,QAAQ,CAACF,SAASC,aAAa,OAAOD;IAC/C,MAAMG,UAAUT,KAAKU,OAAO,CAACJ;IAC7B,IAAIG,YAAYH,KAAK,MAAM,IAAIK,MAAM,GAAGC,MAAM,CAACL,aAAa;IAC5D,OAAOF,YAAYI,SAASF;AAC9B;AACA,MAAMM,SAASb,KAAKc,IAAI,CAACT,YAAYU,WAAW,eAAe,UAAU;AAEzE,eAAe,SAASC,MAAMC,IAAI,EAAEC,OAAO,EAAEC,EAAE;IAC7ChB,KAAKD,YAAYgB,UAAU,CAACE,MAAMC;QAChC,MAAMC,QAAQ,IAAIrB,MAAM;QACxBqB,MAAMC,KAAK,CAAC,CAACJ;YACX,MAAMK,QAAQP,KAAKQ,MAAM,GAAGR,IAAI,CAAC,EAAE,GAAG;YACtCb,MAAM,SAAS;gBAAC;gBAASS;gBAAQW;aAAM,EAAE,CAAC,GAAGL;QAC/C;QACAG,MAAMI,KAAK,CAAC,CAACC;YACXN,QAAQ,CAACO;gBACPT,GAAGQ,OAAOC;YACZ;QACF;IACF;AACF"}