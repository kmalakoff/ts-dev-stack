{"version":3,"sources":["mocha.js"],"sourcesContent":["const path = require('path');\nconst Queue = require('queue-cb');\nconst { spawnArgs } = require('ts-swc-loaders');\n\nconst link = require('../link');\nconst spawn = require('../lib/spawn');\n\nconst major = +process.versions.node.split('.')[0];\nconst type = major >= 12 ? 'module' : 'commonjs';\n\nmodule.exports = function mocha(_args, options, cb) {\n  link(_args, options, (_err, restore) => {\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      const mocha = major >= 12 ? 'mocha' : 'mocha-compat';\n      const cmd = path.resolve(`./node_modules/.bin/${mocha}`);\n      let args = ['--watch-extensions', 'ts,tsx'];\n      if (options.timeout) args.push(['--timeout', options.timeout]);\n      args = args.concat(_args.length ? _args.slice(-1) : ['test/unit/*.test.*']);\n      const argsSpawn = spawnArgs(type, cmd, args, {});\n      spawn(argsSpawn[0], argsSpawn[1], argsSpawn[2], cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n};\n\nmodule.exports.options = { alias: { temp: 't' } };\n"],"names":["path","require","Queue","spawnArgs","link","spawn","major","process","versions","node","split","type","module","exports","mocha","_args","options","cb","_err","restore","queue","defer","cmd","resolve","args","timeout","push","concat","length","slice","argsSpawn","await","err","err2","alias","temp"],"mappings":";AAAA,IAAMA,OAAOC,QAAQ;AACrB,IAAMC,QAAQD,QAAQ;AACtB,IAAM,AAAEE,YAAcF,QAAQ,kBAAtBE;AAER,IAAMC,OAAOH,QAAQ;AACrB,IAAMI,QAAQJ,QAAQ;AAEtB,IAAMK,QAAQ,CAACC,QAAQC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;AAClD,IAAMC,OAAOL,SAAS,KAAK,WAAW;AAEtCM,OAAOC,OAAO,GAAG,SAASC,MAAMC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAChDb,KAAKW,OAAOC,SAAS,SAACE,MAAMC;QAC1B,IAAMC,QAAQ,IAAIlB,MAAM;QACxBkB,MAAMC,KAAK,CAAC,SAACJ;YACX,IAAMH,QAAQR,SAAS,KAAK,UAAU;YACtC,IAAMgB,MAAMtB,KAAKuB,OAAO,CAAC,AAAC,uBAA4B,OAANT;YAChD,IAAIU,OAAO;gBAAC;gBAAsB;aAAS;YAC3C,IAAIR,QAAQS,OAAO,EAAED,KAAKE,IAAI,CAAC;gBAAC;gBAAaV,QAAQS,OAAO;aAAC;YAC7DD,OAAOA,KAAKG,MAAM,CAACZ,MAAMa,MAAM,GAAGb,MAAMc,KAAK,CAAC,CAAC,KAAK;gBAAC;aAAqB;YAC1E,IAAMC,YAAY3B,UAAUQ,MAAMW,KAAKE,MAAM,CAAC;YAC9CnB,MAAMyB,SAAS,CAAC,EAAE,EAAEA,SAAS,CAAC,EAAE,EAAEA,SAAS,CAAC,EAAE,EAAEb;QAClD;QACAG,MAAMW,KAAK,CAAC,SAACC;YACXb,QAAQ,SAACc;gBACPhB,GAAGe,OAAOC;YACZ;QACF;IACF;AACF;AAEArB,OAAOC,OAAO,CAACG,OAAO,GAAG;IAAEkB,OAAO;QAAEC,MAAM;IAAI;AAAE"}