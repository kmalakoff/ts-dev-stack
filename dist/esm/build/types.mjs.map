{"version":3,"sources":["types.js"],"sourcesContent":["const path = require('path');\nconst Iterator = require('fs-iterator');\nconst getTS = require('get-tsconfig-compat');\nconst { createMatcher } = require('ts-swc-loaders');\n\nconst rimraf2 = require('rimraf2');\nconst spawn = require('../lib/spawn');\nconst source = require('../lib/source');\n\nmodule.exports = function types(_args, options, cb) {\n  const cwd = options.cwd || process.cwd();\n  const src = source(options);\n  const srcFolder = path.dirname(path.resolve(cwd, src));\n  const dest = path.join(cwd, 'dist', 'types');\n\n  const config = getTS.getTsconfig(path.resolve(cwd, 'tsconfig.json'));\n  const matcher = createMatcher(config);\n  const tsArgs = [];\n  for (const key in config.config.compilerOptions) {\n    const value = config.config.compilerOptions[key];\n    tsArgs.push(`--${key}`);\n    tsArgs.push(Array.isArray(value) ? value.join(',') : value);\n  }\n\n  rimraf2(dest, { disableGlob: true }, () => {\n    const files = [];\n    const iterator = new Iterator(srcFolder);\n    iterator.forEach(\n      (entry, callback) => {\n        if (!entry.stats.isFile()) return callback();\n        if (!matcher(entry.fullPath)) return callback();\n        files.push(entry.fullPath);\n        callback();\n      },\n      { callbacks: true, concurrency: 1024 },\n      (err) => {\n        if (err) return cb(err);\n        const args = files.concat(['--declaration', '--emitDeclarationOnly', '--outDir', dest]).concat(tsArgs);\n        spawn('tsc', args, { cwd }, cb);\n      }\n    );\n  });\n};\n"],"names":["path","require","Iterator","getTS","createMatcher","rimraf2","spawn","source","module","exports","types","_args","options","cb","cwd","process","src","srcFolder","dirname","resolve","dest","join","config","getTsconfig","matcher","tsArgs","key","compilerOptions","value","push","Array","isArray","disableGlob","files","iterator","forEach","entry","callback","stats","isFile","fullPath","callbacks","concurrency","err","args","concat"],"mappings":"AAAA,MAAMA,OAAOC,QAAQ;AACrB,MAAMC,WAAWD,QAAQ;AACzB,MAAME,QAAQF,QAAQ;AACtB,MAAM,EAAEG,aAAa,EAAE,GAAGH,QAAQ;AAElC,MAAMI,UAAUJ,QAAQ;AACxB,MAAMK,QAAQL,QAAQ;AACtB,MAAMM,SAASN,QAAQ;AAEvBO,OAAOC,OAAO,GAAG,SAASC,MAAMC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAChD,MAAMC,MAAMF,QAAQE,GAAG,IAAIC,QAAQD,GAAG;IACtC,MAAME,MAAMT,OAAOK;IACnB,MAAMK,YAAYjB,KAAKkB,OAAO,CAAClB,KAAKmB,OAAO,CAACL,KAAKE;IACjD,MAAMI,OAAOpB,KAAKqB,IAAI,CAACP,KAAK,QAAQ;IAEpC,MAAMQ,SAASnB,MAAMoB,WAAW,CAACvB,KAAKmB,OAAO,CAACL,KAAK;IACnD,MAAMU,UAAUpB,cAAckB;IAC9B,MAAMG,SAAS,EAAE;IACjB,IAAK,MAAMC,OAAOJ,OAAOA,MAAM,CAACK,eAAe,CAAE;QAC/C,MAAMC,QAAQN,OAAOA,MAAM,CAACK,eAAe,CAACD,IAAI;QAChDD,OAAOI,IAAI,CAAC,CAAC,EAAE,EAAEH,KAAK;QACtBD,OAAOI,IAAI,CAACC,MAAMC,OAAO,CAACH,SAASA,MAAMP,IAAI,CAAC,OAAOO;IACvD;IAEAvB,QAAQe,MAAM;QAAEY,aAAa;IAAK,GAAG;QACnC,MAAMC,QAAQ,EAAE;QAChB,MAAMC,WAAW,IAAIhC,SAASe;QAC9BiB,SAASC,OAAO,CACd,CAACC,OAAOC;YACN,IAAI,CAACD,MAAME,KAAK,CAACC,MAAM,IAAI,OAAOF;YAClC,IAAI,CAACb,QAAQY,MAAMI,QAAQ,GAAG,OAAOH;YACrCJ,MAAMJ,IAAI,CAACO,MAAMI,QAAQ;YACzBH;QACF,GACA;YAAEI,WAAW;YAAMC,aAAa;QAAK,GACrC,CAACC;YACC,IAAIA,KAAK,OAAO9B,GAAG8B;YACnB,MAAMC,OAAOX,MAAMY,MAAM,CAAC;gBAAC;gBAAiB;gBAAyB;gBAAYzB;aAAK,EAAEyB,MAAM,CAACpB;YAC/FnB,MAAM,OAAOsC,MAAM;gBAAE9B;YAAI,GAAGD;QAC9B;IAEJ;AACF"}