{"version":3,"sources":["command.js"],"sourcesContent":["const Queue = require('queue-cb');\n\nconst { link, installPath, spawn, optionsToArgs } = require('tsds-lib');\n\nconst major = +process.versions.node.split('.')[0];\nconst mochaName = major < 12 ? 'mocha-compat' : 'mocha';\n\nlet binMocha = null;\nmodule.exports = function command(_args, options, cb) {\n  if (!binMocha) binMocha = require.resolve(`${mochaName}/bin/_${mochaName}`);\n  const cwd = options.cwd || process.cwd();\n\n  link(installPath(options), (_err, restore) => {\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      let args = [binMocha, '--watch-extensions', 'ts,tsx'];\n      args = args.concat(optionsToArgs(options));\n      args = args.concat(_args.length ? _args.slice(-1) : ['test/**/*.test.*']);\n      spawn('ts-swc', args, { cwd }, cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n};\n\nmodule.exports.options = { alias: { temp: 't' } };\n"],"names":["Queue","require","link","installPath","spawn","optionsToArgs","major","process","versions","node","split","mochaName","binMocha","module","exports","command","_args","options","cb","resolve","cwd","_err","restore","queue","defer","args","concat","length","slice","await","err","err2","alias","temp"],"mappings":";AAAA,IAAMA,QAAQC,QAAQ;AAEtB,IAAoDA,WAAAA,QAAQ,aAApDC,OAA4CD,SAA5CC,MAAMC,cAAsCF,SAAtCE,aAAaC,QAAyBH,SAAzBG,OAAOC,gBAAkBJ,SAAlBI;AAElC,IAAMC,QAAQ,CAACC,QAAQC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;AAClD,IAAMC,YAAYL,QAAQ,KAAK,iBAAiB;AAEhD,IAAIM,WAAW;AACfC,OAAOC,OAAO,GAAG,SAASC,QAAQC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAClD,IAAI,CAACN,UAAUA,WAAWX,QAAQkB,OAAO,CAAC,AAAC,GAAoBR,OAAlBA,WAAU,UAAkB,OAAVA;IAC/D,IAAMS,MAAMH,QAAQG,GAAG,IAAIb,QAAQa,GAAG;IAEtClB,KAAKC,YAAYc,UAAU,SAACI,MAAMC;QAChC,IAAMC,QAAQ,IAAIvB,MAAM;QACxBuB,MAAMC,KAAK,CAAC,SAACN;YACX,IAAIO,OAAO;gBAACb;gBAAU;gBAAsB;aAAS;YACrDa,OAAOA,KAAKC,MAAM,CAACrB,cAAcY;YACjCQ,OAAOA,KAAKC,MAAM,CAACV,MAAMW,MAAM,GAAGX,MAAMY,KAAK,CAAC,CAAC,KAAK;gBAAC;aAAmB;YACxExB,MAAM,UAAUqB,MAAM;gBAAEL,KAAAA;YAAI,GAAGF;QACjC;QACAK,MAAMM,KAAK,CAAC,SAACC;YACXR,QAAQ,SAACS;gBACPb,GAAGY,OAAOC;YACZ;QACF;IACF;AACF;AAEAlB,OAAOC,OAAO,CAACG,OAAO,GAAG;IAAEe,OAAO;QAAEC,MAAM;IAAI;AAAE"}