{"version":3,"sources":["c8.js"],"sourcesContent":["const path = require('path');\nconst rimraf = require('rimraf');\nconst Queue = require('queue-cb');\n// const { spawnArgs } = require('ts-swc-loaders');\n\nconst link = require('../link');\nconst spawn = require('../lib/spawn');\n\n// const major = +process.versions.node.split('.')[0];\n// const type = major >= 12 ? 'module' : 'commonjs';\n\nmodule.exports = function c8(_args, options, cb) {\n  link(_args, options, (err, restore) => {\n    if (err) return cb(err);\n\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      rimraf(path.resolve(process.cwd(), 'coverage'), () => {\n        cb();\n      });\n    });\n    queue.defer((cb) => {\n      // TODO: get spawn working for c8\n      const cmd = require.resolve('c8/bin/c8');\n      let args = ['--no-warnings=ExperimentalWarning', cmd, '--config', path.join(__dirname, '..', '..', '..', 'assets', 'c8rc.json'), 'mocha', '--watch-extensions', 'ts,tsx'];\n      args = args.concat(_args.length ? _args.slice(-1) : ['test/**/*.test.*']);\n      spawn('node', args, { env: { NODE_OPTIONS: '--no-warnings=ExperimentalWarning --loader ts-swc-loaders' } }, cb);\n      // const argsSpawn = spawnArgs(type, cmd, args, {});\n      // spawn(argsSpawn[0], argsSpawn[1], argsSpawn[2], cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n};\n"],"names":["path","require","rimraf","Queue","link","spawn","module","exports","c8","_args","options","cb","err","restore","queue","defer","resolve","process","cwd","cmd","args","join","__dirname","concat","length","slice","env","NODE_OPTIONS","await","err2"],"mappings":"AAAA,MAAMA,OAAOC,QAAQ;AACrB,MAAMC,SAASD,QAAQ;AACvB,MAAME,QAAQF,QAAQ;AACtB,mDAAmD;AAEnD,MAAMG,OAAOH,QAAQ;AACrB,MAAMI,QAAQJ,QAAQ;AAEtB,sDAAsD;AACtD,oDAAoD;AAEpDK,OAAOC,OAAO,GAAG,SAASC,GAAGC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAC7CP,KAAKK,OAAOC,SAAS,CAACE,KAAKC;QACzB,IAAID,KAAK,OAAOD,GAAGC;QAEnB,MAAME,QAAQ,IAAIX,MAAM;QACxBW,MAAMC,KAAK,CAAC,CAACJ;YACXT,OAAOF,KAAKgB,OAAO,CAACC,QAAQC,GAAG,IAAI,aAAa;gBAC9CP;YACF;QACF;QACAG,MAAMC,KAAK,CAAC,CAACJ;YACX,iCAAiC;YACjC,MAAMQ,MAAMlB,QAAQe,OAAO,CAAC;YAC5B,IAAII,OAAO;gBAAC;gBAAqCD;gBAAK;gBAAYnB,KAAKqB,IAAI,CAACC,WAAW,MAAM,MAAM,MAAM,UAAU;gBAAc;gBAAS;gBAAsB;aAAS;YACzKF,OAAOA,KAAKG,MAAM,CAACd,MAAMe,MAAM,GAAGf,MAAMgB,KAAK,CAAC,CAAC,KAAK;gBAAC;aAAmB;YACxEpB,MAAM,QAAQe,MAAM;gBAAEM,KAAK;oBAAEC,cAAc;gBAA4D;YAAE,GAAGhB;QAC5G,oDAAoD;QACpD,uDAAuD;QACzD;QACAG,MAAMc,KAAK,CAAC,CAAChB;YACXC,QAAQ,CAACgB;gBACPlB,GAAGC,OAAOiB;YACZ;QACF;IACF;AACF"}