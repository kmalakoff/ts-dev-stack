{"version":3,"sources":["c8.js"],"sourcesContent":["const path = require('node:path');\nconst Queue = require('queue-cb');\n\nconst rimraf = require('../lib/rimraf');\nconst link = require('../link');\nconst spawn = require('../lib/spawn');\nconst optionsToArgs = require('../lib/optionsToArgs');\n\nconst major = +process.versions.node.split('.')[0];\nconst mochaName = major < 12 ? 'mocha-compat' : 'mocha';\n\nlet binC8 = null;\nlet binMocha = null;\nmodule.exports = function c8(_args, options, cb) {\n  if (!binC8) binC8 = require.resolve('c8/bin/c8');\n  if (!binMocha) binMocha = require.resolve(`${mochaName}/bin/_${mochaName}`);\n  const cwd = options.cwd || process.cwd();\n\n  link(_args, options, (err, restore) => {\n    if (err) return cb(err);\n\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      rimraf(path.resolve(process.cwd(), 'coverage'), () => {\n        cb();\n      });\n    });\n    queue.defer((cb) => {\n      let args = [binC8, '--config', path.join(__dirname, '..', '..', '..', 'assets', 'c8rc.json')];\n      args = args.concat([binMocha, '--watch-extensions', 'ts,tsx']);\n      args = args.concat(optionsToArgs(options));\n      args = args.concat(_args.length ? _args.slice(-1) : ['test/**/*.test.*']);\n      spawn('ts-swc', args, { cwd }, cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n};\n"],"names":["path","require","Queue","rimraf","link","spawn","optionsToArgs","major","process","versions","node","split","mochaName","binC8","binMocha","module","exports","c8","_args","options","cb","resolve","cwd","err","restore","queue","defer","args","join","__dirname","concat","length","slice","await","err2"],"mappings":"AAAA,MAAMA,OAAOC,QAAQ;AACrB,MAAMC,QAAQD,QAAQ;AAEtB,MAAME,SAASF,QAAQ;AACvB,MAAMG,OAAOH,QAAQ;AACrB,MAAMI,QAAQJ,QAAQ;AACtB,MAAMK,gBAAgBL,QAAQ;AAE9B,MAAMM,QAAQ,CAACC,QAAQC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;AAClD,MAAMC,YAAYL,QAAQ,KAAK,iBAAiB;AAEhD,IAAIM,QAAQ;AACZ,IAAIC,WAAW;AACfC,OAAOC,OAAO,GAAG,SAASC,GAAGC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAC7C,IAAI,CAACP,OAAOA,QAAQZ,QAAQoB,OAAO,CAAC;IACpC,IAAI,CAACP,UAAUA,WAAWb,QAAQoB,OAAO,CAAC,GAAGT,UAAU,MAAM,EAAEA,WAAW;IAC1E,MAAMU,MAAMH,QAAQG,GAAG,IAAId,QAAQc,GAAG;IAEtClB,KAAKc,OAAOC,SAAS,CAACI,KAAKC;QACzB,IAAID,KAAK,OAAOH,GAAGG;QAEnB,MAAME,QAAQ,IAAIvB,MAAM;QACxBuB,MAAMC,KAAK,CAAC,CAACN;YACXjB,OAAOH,KAAKqB,OAAO,CAACb,QAAQc,GAAG,IAAI,aAAa;gBAC9CF;YACF;QACF;QACAK,MAAMC,KAAK,CAAC,CAACN;YACX,IAAIO,OAAO;gBAACd;gBAAO;gBAAYb,KAAK4B,IAAI,CAACC,WAAW,MAAM,MAAM,MAAM,UAAU;aAAa;YAC7FF,OAAOA,KAAKG,MAAM,CAAC;gBAAChB;gBAAU;gBAAsB;aAAS;YAC7Da,OAAOA,KAAKG,MAAM,CAACxB,cAAca;YACjCQ,OAAOA,KAAKG,MAAM,CAACZ,MAAMa,MAAM,GAAGb,MAAMc,KAAK,CAAC,CAAC,KAAK;gBAAC;aAAmB;YACxE3B,MAAM,UAAUsB,MAAM;gBAAEL;YAAI,GAAGF;QACjC;QACAK,MAAMQ,KAAK,CAAC,CAACV;YACXC,QAAQ,CAACU;gBACPd,GAAGG,OAAOW;YACZ;QACF;IACF;AACF"}