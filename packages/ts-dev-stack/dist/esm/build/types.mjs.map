{"version":3,"sources":["types.mjs"],"sourcesContent":["import path from 'path';\nimport Iterator from 'fs-iterator';\nimport getTS from 'get-tsconfig-compat';\nimport { createMatcher } from 'ts-swc-transform';\n\nimport rimraf2 from 'rimraf2';\nimport { source, spawn } from 'tsds-lib';\n\nexport default function types(_args, options, cb) {\n  const cwd = options.cwd || process.cwd();\n  const src = source(options);\n  const srcFolder = path.dirname(path.resolve(cwd, src));\n  const dest = path.join(cwd, 'dist', 'types');\n\n  const config = getTS.getTsconfig(path.resolve(cwd, 'tsconfig.json'));\n  const matcher = createMatcher(config);\n  const tsArgs = [];\n  for (const key in config.config.compilerOptions) {\n    const value = config.config.compilerOptions[key];\n    tsArgs.push(`--${key}`);\n    tsArgs.push(Array.isArray(value) ? value.join(',') : value);\n  }\n\n  rimraf2(dest, { disableGlob: true }, () => {\n    const files = [];\n    const iterator = new Iterator(srcFolder);\n    iterator.forEach(\n      (entry, callback) => {\n        if (!entry.stats.isFile()) return callback();\n        if (!matcher(entry.fullPath)) return callback();\n        files.push(entry.fullPath);\n        callback();\n      },\n      { callbacks: true, concurrency: 1024 },\n      (err) => {\n        if (err) return cb(err);\n        const args = files.concat(['--declaration', '--emitDeclarationOnly', '--outDir', dest]).concat(tsArgs);\n        spawn('tsc', args, { cwd }, cb);\n      }\n    );\n  });\n}\n"],"names":["path","Iterator","getTS","createMatcher","rimraf2","source","spawn","types","_args","options","cb","cwd","process","src","srcFolder","dirname","resolve","dest","join","config","getTsconfig","matcher","tsArgs","key","compilerOptions","value","push","Array","isArray","disableGlob","files","iterator","forEach","entry","callback","stats","isFile","fullPath","callbacks","concurrency","err","args","concat"],"mappings":"AAAA,OAAOA,UAAU,OAAO;AACxB,OAAOC,cAAc,cAAc;AACnC,OAAOC,WAAW,sBAAsB;AACxC,SAASC,aAAa,QAAQ,mBAAmB;AAEjD,OAAOC,aAAa,UAAU;AAC9B,SAASC,MAAM,EAAEC,KAAK,QAAQ,WAAW;AAEzC,eAAe,SAASC,MAAMC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAC9C,MAAMC,MAAMF,QAAQE,GAAG,IAAIC,QAAQD,GAAG;IACtC,MAAME,MAAMR,OAAOI;IACnB,MAAMK,YAAYd,KAAKe,OAAO,CAACf,KAAKgB,OAAO,CAACL,KAAKE;IACjD,MAAMI,OAAOjB,KAAKkB,IAAI,CAACP,KAAK,QAAQ;IAEpC,MAAMQ,SAASjB,MAAMkB,WAAW,CAACpB,KAAKgB,OAAO,CAACL,KAAK;IACnD,MAAMU,UAAUlB,cAAcgB;IAC9B,MAAMG,SAAS,EAAE;IACjB,IAAK,MAAMC,OAAOJ,OAAOA,MAAM,CAACK,eAAe,CAAE;QAC/C,MAAMC,QAAQN,OAAOA,MAAM,CAACK,eAAe,CAACD,IAAI;QAChDD,OAAOI,IAAI,CAAC,CAAC,EAAE,EAAEH,KAAK;QACtBD,OAAOI,IAAI,CAACC,MAAMC,OAAO,CAACH,SAASA,MAAMP,IAAI,CAAC,OAAOO;IACvD;IAEArB,QAAQa,MAAM;QAAEY,aAAa;IAAK,GAAG;QACnC,MAAMC,QAAQ,EAAE;QAChB,MAAMC,WAAW,IAAI9B,SAASa;QAC9BiB,SAASC,OAAO,CACd,CAACC,OAAOC;YACN,IAAI,CAACD,MAAME,KAAK,CAACC,MAAM,IAAI,OAAOF;YAClC,IAAI,CAACb,QAAQY,MAAMI,QAAQ,GAAG,OAAOH;YACrCJ,MAAMJ,IAAI,CAACO,MAAMI,QAAQ;YACzBH;QACF,GACA;YAAEI,WAAW;YAAMC,aAAa;QAAK,GACrC,CAACC;YACC,IAAIA,KAAK,OAAO9B,GAAG8B;YACnB,MAAMC,OAAOX,MAAMY,MAAM,CAAC;gBAAC;gBAAiB;gBAAyB;gBAAYzB;aAAK,EAAEyB,MAAM,CAACpB;YAC/FhB,MAAM,OAAOmC,MAAM;gBAAE9B;YAAI,GAAGD;QAC9B;IAEJ;AACF"}