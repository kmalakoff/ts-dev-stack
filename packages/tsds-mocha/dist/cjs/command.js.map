{"version":3,"sources":["command.mjs"],"sourcesContent":["import Queue from 'queue-cb';\n\nimport { installPath, link, optionsToArgs, spawn } from 'tsds-lib';\n\nconst major = +process.versions.node.split('.')[0];\nconst mochaName = major < 12 ? 'mocha-compat' : 'mocha';\n\nlet binMocha = null;\nexport default function command(_args, options, cb) {\n  if (!binMocha) binMocha = require.resolve(`${mochaName}/bin/_${mochaName}`);\n  const cwd = options.cwd || process.cwd();\n\n  link(installPath(options), (_err, restore) => {\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      let args = [binMocha, '--watch-extensions', 'ts,tsx'];\n      args = args.concat(optionsToArgs(options));\n      args = args.concat(_args.length ? _args.slice(-1) : ['test/**/*.test.*']);\n      spawn('ts-swc', args, { cwd }, cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n}\n\nmodule.exports.options = { alias: { temp: 't' } };\n"],"names":["command","major","process","versions","node","split","mochaName","binMocha","_args","options","cb","require","resolve","cwd","link","installPath","_err","restore","queue","Queue","defer","args","concat","optionsToArgs","length","slice","spawn","await","err","err2","module","exports","alias","temp"],"mappings":";;;;+BAQA;;;eAAwBA;;;8DARN;uBAEsC;;;;;;AAExD,IAAMC,QAAQ,CAACC,QAAQC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;AAClD,IAAMC,YAAYL,QAAQ,KAAK,iBAAiB;AAEhD,IAAIM,WAAW;AACA,SAASP,QAAQQ,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAChD,IAAI,CAACH,UAAUA,WAAWI,QAAQC,OAAO,CAAC,AAAC,GAAoBN,OAAlBA,WAAU,UAAkB,OAAVA;IAC/D,IAAMO,MAAMJ,QAAQI,GAAG,IAAIX,QAAQW,GAAG;IAEtCC,IAAAA,aAAI,EAACC,IAAAA,oBAAW,EAACN,UAAU,SAACO,MAAMC;QAChC,IAAMC,QAAQ,IAAIC,gBAAK,CAAC;QACxBD,MAAME,KAAK,CAAC,SAACV;YACX,IAAIW,OAAO;gBAACd;gBAAU;gBAAsB;aAAS;YACrDc,OAAOA,KAAKC,MAAM,CAACC,IAAAA,sBAAa,EAACd;YACjCY,OAAOA,KAAKC,MAAM,CAACd,MAAMgB,MAAM,GAAGhB,MAAMiB,KAAK,CAAC,CAAC,KAAK;gBAAC;aAAmB;YACxEC,IAAAA,cAAK,EAAC,UAAUL,MAAM;gBAAER,KAAAA;YAAI,GAAGH;QACjC;QACAQ,MAAMS,KAAK,CAAC,SAACC;YACXX,QAAQ,SAACY;gBACPnB,GAAGkB,OAAOC;YACZ;QACF;IACF;AACF;AAEAC,OAAOC,OAAO,CAACtB,OAAO,GAAG;IAAEuB,OAAO;QAAEC,MAAM;IAAI;AAAE"}