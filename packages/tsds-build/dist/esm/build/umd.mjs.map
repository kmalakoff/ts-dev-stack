{"version":3,"sources":["umd.mjs"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport Queue from 'queue-cb';\n\nimport rimraf2 from 'rimraf2';\nimport { source, spawn } from 'tsds-lib';\n\nfunction packageRoot(dir, packageName) {\n  if (path.basename(dir) === packageName) return dir;\n  const nextDir = path.dirname(dir);\n  if (nextDir === dir) throw new Error(''.concat(packageName, ' not found'));\n  return packageRoot(nextDir, packageName);\n}\nconst config = path.resolve(packageRoot(__dirname, 'tsds-build'), 'dist', 'esm', 'rollup-swc', 'index.mjs');\n\nexport default function umd(_args, options, cb) {\n  const cwd = options.cwd || process.cwd();\n  const src = path.resolve(cwd, source(options));\n\n  options = { ...options };\n  options.type = 'umd';\n  options.sourceMaps = true;\n  options.dest = path.join(cwd, 'dist', 'umd');\n  rimraf2(options.dest, { disableGlob: true }, () => {\n    const queue = new Queue(1);\n    queue.defer(spawn.bind(null, 'rollup', ['--config', config, '--input', src], { cwd }));\n    queue.defer(fs.writeFile.bind(null, path.join(options.dest, 'package.json'), '{\"type\":\"commonjs\"}'));\n    queue.await(cb);\n  });\n}\n"],"names":["fs","path","Queue","rimraf2","source","spawn","packageRoot","dir","packageName","basename","nextDir","dirname","Error","concat","config","resolve","__dirname","umd","_args","options","cb","cwd","process","src","type","sourceMaps","dest","join","disableGlob","queue","defer","bind","writeFile","await"],"mappings":"AAAA,OAAOA,QAAQ,KAAK;AACpB,OAAOC,UAAU,OAAO;AACxB,OAAOC,WAAW,WAAW;AAE7B,OAAOC,aAAa,UAAU;AAC9B,SAASC,MAAM,EAAEC,KAAK,QAAQ,WAAW;AAEzC,SAASC,YAAYC,GAAG,EAAEC,WAAW;IACnC,IAAIP,KAAKQ,QAAQ,CAACF,SAASC,aAAa,OAAOD;IAC/C,MAAMG,UAAUT,KAAKU,OAAO,CAACJ;IAC7B,IAAIG,YAAYH,KAAK,MAAM,IAAIK,MAAM,GAAGC,MAAM,CAACL,aAAa;IAC5D,OAAOF,YAAYI,SAASF;AAC9B;AACA,MAAMM,SAASb,KAAKc,OAAO,CAACT,YAAYU,WAAW,eAAe,QAAQ,OAAO,cAAc;AAE/F,eAAe,SAASC,IAAIC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAC5C,MAAMC,MAAMF,QAAQE,GAAG,IAAIC,QAAQD,GAAG;IACtC,MAAME,MAAMtB,KAAKc,OAAO,CAACM,KAAKjB,OAAOe;IAErCA,UAAU;QAAE,GAAGA,OAAO;IAAC;IACvBA,QAAQK,IAAI,GAAG;IACfL,QAAQM,UAAU,GAAG;IACrBN,QAAQO,IAAI,GAAGzB,KAAK0B,IAAI,CAACN,KAAK,QAAQ;IACtClB,QAAQgB,QAAQO,IAAI,EAAE;QAAEE,aAAa;IAAK,GAAG;QAC3C,MAAMC,QAAQ,IAAI3B,MAAM;QACxB2B,MAAMC,KAAK,CAACzB,MAAM0B,IAAI,CAAC,MAAM,UAAU;YAAC;YAAYjB;YAAQ;YAAWS;SAAI,EAAE;YAAEF;QAAI;QACnFQ,MAAMC,KAAK,CAAC9B,GAAGgC,SAAS,CAACD,IAAI,CAAC,MAAM9B,KAAK0B,IAAI,CAACR,QAAQO,IAAI,EAAE,iBAAiB;QAC7EG,MAAMI,KAAK,CAACb;IACd;AACF"}