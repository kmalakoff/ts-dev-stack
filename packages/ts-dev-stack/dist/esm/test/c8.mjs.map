{"version":3,"sources":["c8.js"],"sourcesContent":["const path = require('path');\nconst Queue = require('queue-cb');\n\nconst rimraf2 = require('rimraf2');\nconst { installPath, link, spawn, optionsToArgs } = require('tsds-lib');\n\nconst major = +process.versions.node.split('.')[0];\nconst mochaName = major < 12 ? 'mocha-compat' : 'mocha';\n\nlet binC8 = null;\nlet binMocha = null;\nmodule.exports = function c8(_args, options, cb) {\n  if (!binC8) binC8 = require.resolve('c8/bin/c8');\n  if (!binMocha) binMocha = require.resolve(`${mochaName}/bin/_${mochaName}`);\n  const cwd = options.cwd || process.cwd();\n\n  link(installPath(options), (err, restore) => {\n    if (err) return cb(err);\n\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      rimraf2(path.resolve(process.cwd(), { disableGlob: true }, 'coverage'), () => {\n        cb();\n      });\n    });\n    queue.defer((cb) => {\n      let args = [binC8, '--config', path.join(__dirname, '..', '..', '..', 'assets', 'c8rc.json')];\n      args = args.concat([binMocha, '--watch-extensions', 'ts,tsx']);\n      args = args.concat(optionsToArgs(options));\n      args = args.concat(_args.length ? _args.slice(-1) : ['test/**/*.test.*']);\n      spawn('ts-swc', args, { cwd }, cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n};\n"],"names":["path","require","Queue","rimraf2","installPath","link","spawn","optionsToArgs","major","process","versions","node","split","mochaName","binC8","binMocha","module","exports","c8","_args","options","cb","resolve","cwd","err","restore","queue","defer","disableGlob","args","join","__dirname","concat","length","slice","await","err2"],"mappings":"AAAA,MAAMA,OAAOC,QAAQ;AACrB,MAAMC,QAAQD,QAAQ;AAEtB,MAAME,UAAUF,QAAQ;AACxB,MAAM,EAAEG,WAAW,EAAEC,IAAI,EAAEC,KAAK,EAAEC,aAAa,EAAE,GAAGN,QAAQ;AAE5D,MAAMO,QAAQ,CAACC,QAAQC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;AAClD,MAAMC,YAAYL,QAAQ,KAAK,iBAAiB;AAEhD,IAAIM,QAAQ;AACZ,IAAIC,WAAW;AACfC,OAAOC,OAAO,GAAG,SAASC,GAAGC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAC7C,IAAI,CAACP,OAAOA,QAAQb,QAAQqB,OAAO,CAAC;IACpC,IAAI,CAACP,UAAUA,WAAWd,QAAQqB,OAAO,CAAC,GAAGT,UAAU,MAAM,EAAEA,WAAW;IAC1E,MAAMU,MAAMH,QAAQG,GAAG,IAAId,QAAQc,GAAG;IAEtClB,KAAKD,YAAYgB,UAAU,CAACI,KAAKC;QAC/B,IAAID,KAAK,OAAOH,GAAGG;QAEnB,MAAME,QAAQ,IAAIxB,MAAM;QACxBwB,MAAMC,KAAK,CAAC,CAACN;YACXlB,QAAQH,KAAKsB,OAAO,CAACb,QAAQc,GAAG,IAAI;gBAAEK,aAAa;YAAK,GAAG,aAAa;gBACtEP;YACF;QACF;QACAK,MAAMC,KAAK,CAAC,CAACN;YACX,IAAIQ,OAAO;gBAACf;gBAAO;gBAAYd,KAAK8B,IAAI,CAACC,WAAW,MAAM,MAAM,MAAM,UAAU;aAAa;YAC7FF,OAAOA,KAAKG,MAAM,CAAC;gBAACjB;gBAAU;gBAAsB;aAAS;YAC7Dc,OAAOA,KAAKG,MAAM,CAACzB,cAAca;YACjCS,OAAOA,KAAKG,MAAM,CAACb,MAAMc,MAAM,GAAGd,MAAMe,KAAK,CAAC,CAAC,KAAK;gBAAC;aAAmB;YACxE5B,MAAM,UAAUuB,MAAM;gBAAEN;YAAI,GAAGF;QACjC;QACAK,MAAMS,KAAK,CAAC,CAACX;YACXC,QAAQ,CAACW;gBACPf,GAAGG,OAAOY;YACZ;QACF;IACF;AACF"}