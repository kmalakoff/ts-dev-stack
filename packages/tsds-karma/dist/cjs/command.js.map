{"version":3,"sources":["command.mjs"],"sourcesContent":["import path from 'path';\nimport Queue from 'queue-cb';\nimport { installPath, link, spawn } from 'tsds-lib';\n\nfunction packageRoot(dir, packageName) {\n  if (path.basename(dir) === packageName) return dir;\n  const nextDir = path.dirname(dir);\n  if (nextDir === dir) throw new Error(''.concat(packageName, ' not found'));\n  return packageRoot(nextDir, packageName);\n}\nconst config = path.join(packageRoot(__dirname, 'tsds-karma'), 'assets', 'karma.conf.js');\n\nexport default function karma(args, options, cb) {\n  link(installPath(options), (_err, restore) => {\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      const tests = args.length ? args[0] : 'test/**/*.test.*';\n      spawn('karma', ['start', config, tests], {}, cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n}\n"],"names":["karma","packageRoot","dir","packageName","path","basename","nextDir","dirname","Error","concat","config","join","__dirname","args","options","cb","link","installPath","_err","restore","queue","Queue","defer","tests","length","spawn","await","err","err2"],"mappings":";;;;+BAYA;;;eAAwBA;;;2DAZP;8DACC;uBACuB;;;;;;AAEzC,SAASC,YAAYC,GAAG,EAAEC,WAAW;IACnC,IAAIC,aAAI,CAACC,QAAQ,CAACH,SAASC,aAAa,OAAOD;IAC/C,IAAMI,UAAUF,aAAI,CAACG,OAAO,CAACL;IAC7B,IAAII,YAAYJ,KAAK,MAAM,IAAIM,MAAM,GAAGC,MAAM,CAACN,aAAa;IAC5D,OAAOF,YAAYK,SAASH;AAC9B;AACA,IAAMO,SAASN,aAAI,CAACO,IAAI,CAACV,YAAYW,WAAW,eAAe,UAAU;AAE1D,SAASZ,MAAMa,IAAI,EAAEC,OAAO,EAAEC,EAAE;IAC7CC,IAAAA,aAAI,EAACC,IAAAA,oBAAW,EAACH,UAAU,SAACI,MAAMC;QAChC,IAAMC,QAAQ,IAAIC,gBAAK,CAAC;QACxBD,MAAME,KAAK,CAAC,SAACP;YACX,IAAMQ,QAAQV,KAAKW,MAAM,GAAGX,IAAI,CAAC,EAAE,GAAG;YACtCY,IAAAA,cAAK,EAAC,SAAS;gBAAC;gBAASf;gBAAQa;aAAM,EAAE,CAAC,GAAGR;QAC/C;QACAK,MAAMM,KAAK,CAAC,SAACC;YACXR,QAAQ,SAACS;gBACPb,GAAGY,OAAOC;YACZ;QACF;IACF;AACF"}