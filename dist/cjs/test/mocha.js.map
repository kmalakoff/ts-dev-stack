{"version":3,"sources":["mocha.js"],"sourcesContent":["const _path = require('path');\nconst Queue = require('queue-cb');\nconst spawnArgs = require('ts-swc-loaders/lib/spawnArgs.js');\n\nconst link = require('../link');\nconst spawn = require('../lib/spawn');\n\nconst major = +process.versions.node.split('.')[0];\nconst type = major >= 12 ? 'module' : 'commonjs';\n\nmodule.exports = function mocha(args, options, cb) {\n  link(args, options, (_err, restore) => {\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      const tests = args && args.length ? args[0] : 'test/**/*.test.*';\n      const mochaOptions = options.timeout ? ['--timeout', options.timeout] : [];\n      const mocha = major >= 12 ? 'mocha' : 'mocha-compat';\n      const cmd = require.resolve(`${mocha}/bin/_${mocha}`);\n      const argsSpawn = spawnArgs(type, cmd, mochaOptions.concat(['--watch-extensions', 'ts,tsx', tests]), {});\n      spawn(argsSpawn[0], argsSpawn[1], argsSpawn[2], cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n};\n\nmodule.exports.options = { alias: { temp: 't' } };\n"],"names":["_path","require","Queue","spawnArgs","link","spawn","major","process","versions","node","split","type","module","exports","mocha","args","options","cb","_err","restore","queue","defer","tests","length","mochaOptions","timeout","cmd","resolve","argsSpawn","concat","await","err","err2","alias","temp"],"mappings":";AAAA,IAAMA,QAAQC,QAAQ;AACtB,IAAMC,QAAQD,QAAQ;AACtB,IAAME,YAAYF,QAAQ;AAE1B,IAAMG,OAAOH,QAAQ;AACrB,IAAMI,QAAQJ,QAAQ;AAEtB,IAAMK,QAAQ,CAACC,QAAQC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;AAClD,IAAMC,OAAOL,SAAS,KAAK,WAAW;AAEtCM,OAAOC,OAAO,GAAG,SAASC,MAAMC,IAAI,EAAEC,OAAO,EAAEC,EAAE;IAC/Cb,KAAKW,MAAMC,SAAS,SAACE,MAAMC;QACzB,IAAMC,QAAQ,IAAIlB,MAAM;QACxBkB,MAAMC,KAAK,CAAC,SAACJ;YACX,IAAMK,QAAQP,QAAQA,KAAKQ,MAAM,GAAGR,IAAI,CAAC,EAAE,GAAG;YAC9C,IAAMS,eAAeR,QAAQS,OAAO,GAAG;gBAAC;gBAAaT,QAAQS,OAAO;aAAC,GAAG,EAAE;YAC1E,IAAMX,QAAQR,SAAS,KAAK,UAAU;YACtC,IAAMoB,MAAMzB,QAAQ0B,OAAO,CAAC,AAAC,GAAgBb,OAAdA,OAAM,UAAc,OAANA;YAC7C,IAAMc,YAAYzB,UAAUQ,MAAMe,KAAKF,aAAaK,MAAM,CAAC;gBAAC;gBAAsB;gBAAUP;aAAM,GAAG,CAAC;YACtGjB,MAAMuB,SAAS,CAAC,EAAE,EAAEA,SAAS,CAAC,EAAE,EAAEA,SAAS,CAAC,EAAE,EAAEX;QAClD;QACAG,MAAMU,KAAK,CAAC,SAACC;YACXZ,QAAQ,SAACa;gBACPf,GAAGc,OAAOC;YACZ;QACF;IACF;AACF;AAEApB,OAAOC,OAAO,CAACG,OAAO,GAAG;IAAEiB,OAAO;QAAEC,MAAM;IAAI;AAAE"}