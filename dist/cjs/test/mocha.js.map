{"version":3,"sources":["mocha.js"],"sourcesContent":["const Queue = require('queue-cb');\n\nconst link = require('../link');\nconst spawn = require('../lib/spawn');\nconst optionsToArgs = require('../lib/optionsToArgs');\n\nconst major = +process.versions.node.split('.')[0];\nconst mochaName = major < 12 ? 'mocha-compat' : 'mocha';\n\nlet binMocha = null;\nmodule.exports = function mocha(_args, options, cb) {\n  if (!binMocha) binMocha = require.resolve(`${mochaName}/bin/_${mochaName}`);\n  const cwd = options.cwd || process.cwd();\n\n  link(_args, options, (_err, restore) => {\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      let args = [binMocha, '--watch-extensions', 'ts,tsx'];\n      args = args.concat(optionsToArgs(options));\n      args = args.concat(_args.length ? _args.slice(-1) : ['test/**/*.test.*']);\n      spawn('ts-swc', args, { cwd }, cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n};\n\nmodule.exports.options = { alias: { temp: 't' } };\n"],"names":["Queue","require","link","spawn","optionsToArgs","major","process","versions","node","split","mochaName","binMocha","module","exports","mocha","_args","options","cb","resolve","cwd","_err","restore","queue","defer","args","concat","length","slice","await","err","err2","alias","temp"],"mappings":";AAAA,IAAMA,QAAQC,QAAQ;AAEtB,IAAMC,OAAOD,QAAQ;AACrB,IAAME,QAAQF,QAAQ;AACtB,IAAMG,gBAAgBH,QAAQ;AAE9B,IAAMI,QAAQ,CAACC,QAAQC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;AAClD,IAAMC,YAAYL,QAAQ,KAAK,iBAAiB;AAEhD,IAAIM,WAAW;AACfC,OAAOC,OAAO,GAAG,SAASC,MAAMC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAChD,IAAI,CAACN,UAAUA,WAAWV,QAAQiB,OAAO,CAAC,AAAC,GAAoBR,OAAlBA,WAAU,UAAkB,OAAVA;IAC/D,IAAMS,MAAMH,QAAQG,GAAG,IAAIb,QAAQa,GAAG;IAEtCjB,KAAKa,OAAOC,SAAS,SAACI,MAAMC;QAC1B,IAAMC,QAAQ,IAAItB,MAAM;QACxBsB,MAAMC,KAAK,CAAC,SAACN;YACX,IAAIO,OAAO;gBAACb;gBAAU;gBAAsB;aAAS;YACrDa,OAAOA,KAAKC,MAAM,CAACrB,cAAcY;YACjCQ,OAAOA,KAAKC,MAAM,CAACV,MAAMW,MAAM,GAAGX,MAAMY,KAAK,CAAC,CAAC,KAAK;gBAAC;aAAmB;YACxExB,MAAM,UAAUqB,MAAM;gBAAEL,KAAAA;YAAI,GAAGF;QACjC;QACAK,MAAMM,KAAK,CAAC,SAACC;YACXR,QAAQ,SAACS;gBACPb,GAAGY,OAAOC;YACZ;QACF;IACF;AACF;AAEAlB,OAAOC,OAAO,CAACG,OAAO,GAAG;IAAEe,OAAO;QAAEC,MAAM;IAAI;AAAE"}