{"version":3,"sources":["types.mjs"],"sourcesContent":["import path from 'path';\nimport Iterator from 'fs-iterator';\nimport getTS from 'get-tsconfig-compat';\nimport { createMatcher } from 'ts-swc-transform';\n\nimport rimraf2 from 'rimraf2';\nimport { source, spawn } from 'tsds-lib';\n\nexport default function types(_args, options, cb) {\n  const cwd = options.cwd || process.cwd();\n  const src = source(options);\n  const srcFolder = path.dirname(path.resolve(cwd, src));\n  const dest = path.join(cwd, 'dist', 'types');\n\n  const config = getTS.getTsconfig(path.resolve(cwd, 'tsconfig.json'));\n  const matcher = createMatcher(config);\n  const tsArgs = [];\n  for (const key in config.config.compilerOptions) {\n    const value = config.config.compilerOptions[key];\n    tsArgs.push(`--${key}`);\n    tsArgs.push(Array.isArray(value) ? value.join(',') : value);\n  }\n\n  rimraf2(dest, { disableGlob: true }, () => {\n    const files = [];\n    const iterator = new Iterator(srcFolder);\n    iterator.forEach(\n      (entry, callback) => {\n        if (!entry.stats.isFile()) return callback();\n        if (!matcher(entry.fullPath)) return callback();\n        files.push(entry.fullPath);\n        callback();\n      },\n      { callbacks: true, concurrency: 1024 },\n      (err) => {\n        if (err) return cb(err);\n        const args = files.concat(['--declaration', '--emitDeclarationOnly', '--outDir', dest]).concat(tsArgs);\n        spawn('tsc', args, { cwd }, cb);\n      }\n    );\n  });\n}\n"],"names":["types","_args","options","cb","cwd","process","src","source","srcFolder","path","dirname","resolve","dest","join","config","getTS","getTsconfig","matcher","createMatcher","tsArgs","key","compilerOptions","value","push","Array","isArray","rimraf2","disableGlob","files","iterator","Iterator","forEach","entry","callback","stats","isFile","fullPath","callbacks","concurrency","err","args","concat","spawn"],"mappings":";;;;+BAQA;;;eAAwBA;;;2DARP;iEACI;wEACH;8BACY;8DAEV;uBACU;;;;;;AAEf,SAASA,MAAMC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAC9C,IAAMC,MAAMF,QAAQE,GAAG,IAAIC,QAAQD,GAAG;IACtC,IAAME,MAAMC,IAAAA,eAAM,EAACL;IACnB,IAAMM,YAAYC,aAAI,CAACC,OAAO,CAACD,aAAI,CAACE,OAAO,CAACP,KAAKE;IACjD,IAAMM,OAAOH,aAAI,CAACI,IAAI,CAACT,KAAK,QAAQ;IAEpC,IAAMU,SAASC,0BAAK,CAACC,WAAW,CAACP,aAAI,CAACE,OAAO,CAACP,KAAK;IACnD,IAAMa,UAAUC,IAAAA,6BAAa,EAACJ;IAC9B,IAAMK,SAAS,EAAE;IACjB,IAAK,IAAMC,OAAON,OAAOA,MAAM,CAACO,eAAe,CAAE;QAC/C,IAAMC,QAAQR,OAAOA,MAAM,CAACO,eAAe,CAACD,IAAI;QAChDD,OAAOI,IAAI,CAAC,AAAC,KAAQ,OAAJH;QACjBD,OAAOI,IAAI,CAACC,MAAMC,OAAO,CAACH,SAASA,MAAMT,IAAI,CAAC,OAAOS;IACvD;IAEAI,IAAAA,gBAAO,EAACd,MAAM;QAAEe,aAAa;IAAK,GAAG;QACnC,IAAMC,QAAQ,EAAE;QAChB,IAAMC,WAAW,IAAIC,mBAAQ,CAACtB;QAC9BqB,SAASE,OAAO,CACd,SAACC,OAAOC;YACN,IAAI,CAACD,MAAME,KAAK,CAACC,MAAM,IAAI,OAAOF;YAClC,IAAI,CAAChB,QAAQe,MAAMI,QAAQ,GAAG,OAAOH;YACrCL,MAAML,IAAI,CAACS,MAAMI,QAAQ;YACzBH;QACF,GACA;YAAEI,WAAW;YAAMC,aAAa;QAAK,GACrC,SAACC;YACC,IAAIA,KAAK,OAAOpC,GAAGoC;YACnB,IAAMC,OAAOZ,MAAMa,MAAM,CAAC;gBAAC;gBAAiB;gBAAyB;gBAAY7B;aAAK,EAAE6B,MAAM,CAACtB;YAC/FuB,IAAAA,cAAK,EAAC,OAAOF,MAAM;gBAAEpC,KAAAA;YAAI,GAAGD;QAC9B;IAEJ;AACF"}