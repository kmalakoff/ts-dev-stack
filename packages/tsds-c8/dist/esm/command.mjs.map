{"version":3,"sources":["command.mjs"],"sourcesContent":["import path from 'path';\nimport Queue from 'queue-cb';\n\nimport rimraf2 from 'rimraf2';\nexport { installPath, link, spawn, optionsToArgs } from 'tsds-lib';\n\nconst major = +process.versions.node.split('.')[0];\nconst mochaName = major < 12 ? 'mocha-compat' : 'mocha';\n\nlet binC8 = null;\nlet binMocha = null;\nexport default function c8(_args, options, cb) {\n  if (!binC8) binC8 = require.resolve('c8/bin/c8');\n  if (!binMocha) binMocha = require.resolve(`${mochaName}/bin/_${mochaName}`);\n  const cwd = options.cwd || process.cwd();\n\n  link(installPath(options), (err, restore) => {\n    if (err) return cb(err);\n\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      rimraf2(path.resolve(process.cwd(), { disableGlob: true }, 'coverage'), () => {\n        cb();\n      });\n    });\n    queue.defer((cb) => {\n      let args = [binC8, '--config', path.join(__dirname, '..', '..', '..', 'assets', 'c8rc.json')];\n      args = args.concat([binMocha, '--watch-extensions', 'ts,tsx']);\n      args = args.concat(optionsToArgs(options));\n      args = args.concat(_args.length ? _args.slice(-1) : ['test/**/*.test.*']);\n      spawn('ts-swc', args, { cwd }, cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n}\n"],"names":["path","Queue","rimraf2","installPath","link","spawn","optionsToArgs","major","process","versions","node","split","mochaName","binC8","binMocha","c8","_args","options","cb","require","resolve","cwd","err","restore","queue","defer","disableGlob","args","join","__dirname","concat","length","slice","await","err2"],"mappings":"AAAA,OAAOA,UAAU,OAAO;AACxB,OAAOC,WAAW,WAAW;AAE7B,OAAOC,aAAa,UAAU;AAC9B,SAASC,WAAW,EAAEC,IAAI,EAAEC,KAAK,EAAEC,aAAa,QAAQ,WAAW;AAEnE,MAAMC,QAAQ,CAACC,QAAQC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;AAClD,MAAMC,YAAYL,QAAQ,KAAK,iBAAiB;AAEhD,IAAIM,QAAQ;AACZ,IAAIC,WAAW;AACf,eAAe,SAASC,GAAGC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAC3C,IAAI,CAACL,OAAOA,QAAQM,QAAQC,OAAO,CAAC;IACpC,IAAI,CAACN,UAAUA,WAAWK,QAAQC,OAAO,CAAC,GAAGR,UAAU,MAAM,EAAEA,WAAW;IAC1E,MAAMS,MAAMJ,QAAQI,GAAG,IAAIb,QAAQa,GAAG;IAEtCjB,KAAKD,YAAYc,UAAU,CAACK,KAAKC;QAC/B,IAAID,KAAK,OAAOJ,GAAGI;QAEnB,MAAME,QAAQ,IAAIvB,MAAM;QACxBuB,MAAMC,KAAK,CAAC,CAACP;YACXhB,QAAQF,KAAKoB,OAAO,CAACZ,QAAQa,GAAG,IAAI;gBAAEK,aAAa;YAAK,GAAG,aAAa;gBACtER;YACF;QACF;QACAM,MAAMC,KAAK,CAAC,CAACP;YACX,IAAIS,OAAO;gBAACd;gBAAO;gBAAYb,KAAK4B,IAAI,CAACC,WAAW,MAAM,MAAM,MAAM,UAAU;aAAa;YAC7FF,OAAOA,KAAKG,MAAM,CAAC;gBAAChB;gBAAU;gBAAsB;aAAS;YAC7Da,OAAOA,KAAKG,MAAM,CAACxB,cAAcW;YACjCU,OAAOA,KAAKG,MAAM,CAACd,MAAMe,MAAM,GAAGf,MAAMgB,KAAK,CAAC,CAAC,KAAK;gBAAC;aAAmB;YACxE3B,MAAM,UAAUsB,MAAM;gBAAEN;YAAI,GAAGH;QACjC;QACAM,MAAMS,KAAK,CAAC,CAACX;YACXC,QAAQ,CAACW;gBACPhB,GAAGI,OAAOY;YACZ;QACF;IACF;AACF"}