{"version":3,"sources":["command.mjs"],"sourcesContent":["import path from 'path';\nimport Queue from 'queue-cb';\nimport { installPath, link, spawn } from 'tsds-lib';\n\nconst packageName = 'tsds-karma';\nfunction root(dir) {\n  if (path.basename(dir) === packageName) return dir;\n  const nextDir = path.dirname(dir);\n  if (nextDir === dir) throw new Error(`${packageName} not found`);\n  return root(nextDir);\n}\nconst config = path.join(root(__dirname), 'assets', 'karma.conf.js');\n\nexport default function karma(args, options, cb) {\n  link(installPath(options), (_err, restore) => {\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      const tests = args.length ? args[0] : 'test/**/*.test.*';\n      spawn('karma', ['start', config, tests], {}, cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n}\n"],"names":["karma","packageName","root","dir","path","basename","nextDir","dirname","Error","config","join","__dirname","args","options","cb","link","installPath","_err","restore","queue","Queue","defer","tests","length","spawn","await","err","err2"],"mappings":";;;;+BAaA;;;eAAwBA;;;2DAbP;8DACC;uBACuB;;;;;;AAEzC,IAAMC,cAAc;AACpB,SAASC,KAAKC,GAAG;IACf,IAAIC,aAAI,CAACC,QAAQ,CAACF,SAASF,aAAa,OAAOE;IAC/C,IAAMG,UAAUF,aAAI,CAACG,OAAO,CAACJ;IAC7B,IAAIG,YAAYH,KAAK,MAAM,IAAIK,MAAM,AAAC,GAAc,OAAZP,aAAY;IACpD,OAAOC,KAAKI;AACd;AACA,IAAMG,SAASL,aAAI,CAACM,IAAI,CAACR,KAAKS,YAAY,UAAU;AAErC,SAASX,MAAMY,IAAI,EAAEC,OAAO,EAAEC,EAAE;IAC7CC,IAAAA,aAAI,EAACC,IAAAA,oBAAW,EAACH,UAAU,SAACI,MAAMC;QAChC,IAAMC,QAAQ,IAAIC,gBAAK,CAAC;QACxBD,MAAME,KAAK,CAAC,SAACP;YACX,IAAMQ,QAAQV,KAAKW,MAAM,GAAGX,IAAI,CAAC,EAAE,GAAG;YACtCY,IAAAA,cAAK,EAAC,SAAS;gBAAC;gBAASf;gBAAQa;aAAM,EAAE,CAAC,GAAGR;QAC/C;QACAK,MAAMM,KAAK,CAAC,SAACC;YACXR,QAAQ,SAACS;gBACPb,GAAGY,OAAOC;YACZ;QACF;IACF;AACF"}