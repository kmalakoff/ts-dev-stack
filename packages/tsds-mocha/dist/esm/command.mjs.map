{"version":3,"sources":["command.mjs"],"sourcesContent":["import Queue from 'queue-cb';\n\nimport { installPath, link, optionsToArgs, spawn } from 'tsds-lib';\n\nconst major = +process.versions.node.split('.')[0];\nconst mochaName = major < 12 ? 'mocha-compat' : 'mocha';\n\nlet binMocha = null;\nexport default function command(_args, options, cb) {\n  if (!binMocha) binMocha = require.resolve(`${mochaName}/bin/_${mochaName}`);\n  const cwd = options.cwd || process.cwd();\n\n  link(installPath(options), (_err, restore) => {\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      let args = [binMocha, '--watch-extensions', 'ts,tsx'];\n      args = args.concat(optionsToArgs(options));\n      args = args.concat(_args.length ? _args.slice(-1) : ['test/**/*.test.*']);\n      spawn(require.resolve('ts-swc-loaders/bin/cli.js'), args, { cwd }, cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n}\n\nmodule.exports.options = { alias: { temp: 't' } };\n"],"names":["Queue","installPath","link","optionsToArgs","spawn","major","process","versions","node","split","mochaName","binMocha","command","_args","options","cb","require","resolve","cwd","_err","restore","queue","defer","args","concat","length","slice","await","err","err2","module","exports","alias","temp"],"mappings":"AAAA,OAAOA,WAAW,WAAW;AAE7B,SAASC,WAAW,EAAEC,IAAI,EAAEC,aAAa,EAAEC,KAAK,QAAQ,WAAW;AAEnE,MAAMC,QAAQ,CAACC,QAAQC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;AAClD,MAAMC,YAAYL,QAAQ,KAAK,iBAAiB;AAEhD,IAAIM,WAAW;AACf,eAAe,SAASC,QAAQC,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAChD,IAAI,CAACJ,UAAUA,WAAWK,QAAQC,OAAO,CAAC,GAAGP,UAAU,MAAM,EAAEA,WAAW;IAC1E,MAAMQ,MAAMJ,QAAQI,GAAG,IAAIZ,QAAQY,GAAG;IAEtChB,KAAKD,YAAYa,UAAU,CAACK,MAAMC;QAChC,MAAMC,QAAQ,IAAIrB,MAAM;QACxBqB,MAAMC,KAAK,CAAC,CAACP;YACX,IAAIQ,OAAO;gBAACZ;gBAAU;gBAAsB;aAAS;YACrDY,OAAOA,KAAKC,MAAM,CAACrB,cAAcW;YACjCS,OAAOA,KAAKC,MAAM,CAACX,MAAMY,MAAM,GAAGZ,MAAMa,KAAK,CAAC,CAAC,KAAK;gBAAC;aAAmB;YACxEtB,MAAMY,QAAQC,OAAO,CAAC,8BAA8BM,MAAM;gBAAEL;YAAI,GAAGH;QACrE;QACAM,MAAMM,KAAK,CAAC,CAACC;YACXR,QAAQ,CAACS;gBACPd,GAAGa,OAAOC;YACZ;QACF;IACF;AACF;AAEAC,OAAOC,OAAO,CAACjB,OAAO,GAAG;IAAEkB,OAAO;QAAEC,MAAM;IAAI;AAAE"}