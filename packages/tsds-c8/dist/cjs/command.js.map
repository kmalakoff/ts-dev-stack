{"version":3,"sources":["command.mjs"],"sourcesContent":["import path from 'path';\nimport Queue from 'queue-cb';\n\nimport rimraf2 from 'rimraf2';\nexport { installPath, link, spawn, optionsToArgs } from 'tsds-lib';\n\nconst major = +process.versions.node.split('.')[0];\nconst mochaName = major < 12 ? 'mocha-compat' : 'mocha';\n\nlet binC8 = null;\nlet binMocha = null;\nexport default function c8(_args, options, cb) {\n  if (!binC8) binC8 = require.resolve('c8/bin/c8');\n  if (!binMocha) binMocha = require.resolve(`${mochaName}/bin/_${mochaName}`);\n  const cwd = options.cwd || process.cwd();\n\n  link(installPath(options), (err, restore) => {\n    if (err) return cb(err);\n\n    const queue = new Queue(1);\n    queue.defer((cb) => {\n      rimraf2(path.resolve(process.cwd(), { disableGlob: true }, 'coverage'), () => {\n        cb();\n      });\n    });\n    queue.defer((cb) => {\n      let args = [binC8, '--config', path.join(__dirname, '..', '..', '..', 'assets', 'c8rc.json')];\n      args = args.concat([binMocha, '--watch-extensions', 'ts,tsx']);\n      args = args.concat(optionsToArgs(options));\n      args = args.concat(_args.length ? _args.slice(-1) : ['test/**/*.test.*']);\n      spawn('ts-swc', args, { cwd }, cb);\n    });\n    queue.await((err) => {\n      restore((err2) => {\n        cb(err || err2);\n      });\n    });\n  });\n}\n"],"names":["c8","installPath","link","optionsToArgs","spawn","major","process","versions","node","split","mochaName","binC8","binMocha","_args","options","cb","require","resolve","cwd","err","restore","queue","Queue","defer","rimraf2","path","disableGlob","args","join","__dirname","concat","length","slice","await","err2"],"mappings":";;;;;;;;;;;IAWA,OA2BC;eA3BuBA;;IAPfC,WAAW;eAAXA,oBAAW;;IAAEC,IAAI;eAAJA,aAAI;;IAASC,aAAa;eAAbA,sBAAa;;IAApBC,KAAK;eAALA,cAAK;;;2DAJhB;8DACC;8DAEE;uBACoC;;;;;;AAExD,IAAMC,QAAQ,CAACC,QAAQC,QAAQ,CAACC,IAAI,CAACC,KAAK,CAAC,IAAI,CAAC,EAAE;AAClD,IAAMC,YAAYL,QAAQ,KAAK,iBAAiB;AAEhD,IAAIM,QAAQ;AACZ,IAAIC,WAAW;AACA,SAASZ,GAAGa,KAAK,EAAEC,OAAO,EAAEC,EAAE;IAC3C,IAAI,CAACJ,OAAOA,QAAQK,QAAQC,OAAO,CAAC;IACpC,IAAI,CAACL,UAAUA,WAAWI,QAAQC,OAAO,CAAC,AAAC,GAAoBP,OAAlBA,WAAU,UAAkB,OAAVA;IAC/D,IAAMQ,MAAMJ,QAAQI,GAAG,IAAIZ,QAAQY,GAAG;IAEtChB,KAAKD,YAAYa,UAAU,SAACK,KAAKC;QAC/B,IAAID,KAAK,OAAOJ,GAAGI;QAEnB,IAAME,QAAQ,IAAIC,gBAAK,CAAC;QACxBD,MAAME,KAAK,CAAC,SAACR;YACXS,IAAAA,gBAAO,EAACC,aAAI,CAACR,OAAO,CAACX,QAAQY,GAAG,IAAI;gBAAEQ,aAAa;YAAK,GAAG,aAAa;gBACtEX;YACF;QACF;QACAM,MAAME,KAAK,CAAC,SAACR;YACX,IAAIY,OAAO;gBAAChB;gBAAO;gBAAYc,aAAI,CAACG,IAAI,CAACC,WAAW,MAAM,MAAM,MAAM,UAAU;aAAa;YAC7FF,OAAOA,KAAKG,MAAM,CAAC;gBAAClB;gBAAU;gBAAsB;aAAS;YAC7De,OAAOA,KAAKG,MAAM,CAAC3B,cAAcW;YACjCa,OAAOA,KAAKG,MAAM,CAACjB,MAAMkB,MAAM,GAAGlB,MAAMmB,KAAK,CAAC,CAAC,KAAK;gBAAC;aAAmB;YACxE5B,MAAM,UAAUuB,MAAM;gBAAET,KAAAA;YAAI,GAAGH;QACjC;QACAM,MAAMY,KAAK,CAAC,SAACd;YACXC,QAAQ,SAACc;gBACPnB,GAAGI,OAAOe;YACZ;QACF;IACF;AACF"}